<?xml version='1.0' encoding='UTF-8'?>
<Rule>
    <规则编号>SQLE00035</规则编号>
    <级别>error</级别>
    <数据库类型>MySQL</数据库类型>
    <规则种类>DDL规范</规则种类>
    <规则简述>DDL语句中不建议使用中文全角引号</规则简述>
    <规则描述>建议开启此规则，可避免MySQL会将中文全角引号识别为命名的一部分，执行结果与业务预期不符</规则描述>
    <规则场景>
    <场景 名称="初始化表结构定义" 数据库版本="MySQL 所有版本" 检查方式="不连库审核" 适用句型="所有DDL 语句">
    <示例>  
        前置：
```sql
        create database db_mysql;
        use db_mysql;

```
        原理说明：
        1. 在建表、建索引、修改字段名字等DDL时，禁止这些命名中包含中文全角引号(“ ” 这就是中文全角引号)。
        2. 使用中文全角引号会导致业务查询出来的结果错误或者不符合预期。
        3. 此规则包含而且不限于建表、建索引、修改字段名。可以适用于所有DDL 语句。比如 CREATE DATABASE、CREATE EVENT、CREATE FUNCTION、CREATE VIEW、CREATE SERVER 等。

        反例
        SQL1:
```sql
        create table `“t1”` (id int primary key, c1 int);
```
        SQL2:
```sql
        create table t2(`“id”` int primary key, c1 int);
```
        SQL3:
```sql
        create table t3(id int primary key, c1 int,index `“idx_c1_t3”` (c1));

```
        SQL4:
```sql
        create index `“idx_c1_t2”` on t2(c1);
        alter table t2 add key `“idx_c1_t2_duplicate”` t2(c1);

```
        SQL5:
```sql
        alter table t2 add `“c2”` int;
        alter table t2 change `“c2”` `“c2”` int;
        alter table t2 modify `“c2”` int;

```
        反例说明：
        1. 建立三张表t1、t2、t3，分别使用中文全角引号括住表名、字段名、索引名等。
        2. 不建议这样使用，每次需要特殊处理才能正常插入、查询等，增加业务出错的概率。

        反例验证： 

        1. 正常创建三张表，包含中文全角引号的需要特殊处理，在MySQL 里加反引号。
```sql
        (mysql:8.4.0:db_mysql)create table `“t1”` (id int primary key, c1 int);
        Query OK, 0 rows affected (0.04 sec)


```
        2. 对表 t1 插入和查询： 插入时也需要特殊处理，使用反引号括住表名；查询时也需要特殊处理；如果在插入和查询的时候没有做个数处理，就会报错。
```sql
        (mysql:8.4.0:db_mysql)insert into t1 values (100,200);
        ERROR 1146 (42S02): Table 'db_mysql.t1' doesn't exist

        (mysql:8.4.0:db_mysql)insert into `"t1"` values (100,200);
        ERROR 1146 (42S02): Table 'db_mysql."t1"' doesn't exist

        (mysql:8.4.0:db_mysql)insert into `“t1”` values (100,200);
        Query OK, 1 row affected (0.00 sec)

        (mysql:8.4.0:db_mysql)select * from t1;
        ERROR 1146 (42S02): Table 'db_mysql.t1' doesn't exist

        (mysql:8.4.0:db_mysql)select * from `“t1”`;
        +-----+------+
        | id  | c1   |
        +-----+------+
        | 100 |  200 |
        +-----+------+
        1 row in set (0.00 sec)

```
        正例：
        SQL1:
```sql
        create table t1 (id int primary key, c1 int);
```
        SQL2:
```sql
        create table t2(id int primary key, c1 int);
```
        SQL3:
```sql
        create table t3(id int primary key, c1 int,index idx_c1_t3 (c1));

```
        SQL4:
```sql
        create index idx_c1_t2 on t2(c1);
        alter table t2 add key idx_c1_t2_duplicate t2(c1);

```
        SQL5:
```sql
        alter table t2 add c2 int;
        alter table t2 change c2 c2 int;
        alter table t2 modify c2 int;

```
        正例说明：
        1. 使用正常的英文字符来创建表、字段、索引等对象， 可以避免由于中文全角引号等特殊字符导致的特殊处理预期，增加可读性、可维护性、可操作性。

        正例验证：
        1. 删掉之前创建的表 “t1”,第一次删除失败，由于前面有空格，第二次删除成功。
```sql
        (mysql:8.4.0:db_mysql)drop table ` “t1”`;
        ERROR 1051 (42S02): Unknown table 'db_mysql. “t1”'

        (mysql:8.4.0:db_mysql)drop table `“t1”`;
        Query OK, 0 rows affected (0.02 sec)

```
        2. 正常插入、正常查询。
```sql
        (mysql:8.4.0:db_mysql)insert into t1 select 1,200;
        Query OK, 1 row affected (0.01 sec)
        Records: 1  Duplicates: 0  Warnings: 0

        (mysql:8.4.0:db_mysql)select * from t1;
        +----+------+
        | id | c1   |
        +----+------+
        |  1 |  200 |
        +----+------+
        1 row in set (0.00 sec)

```
        总结：
        1. 对表、字段、索引等对象禁止使用包含中文全角字符的命名，会导致插入、更新、查询等操作时都需要特殊处理，使用反引号括住表名，如果不特殊处理，就会报错，业务无法进行，增加业务的复杂性和可维护性。 
        2. 应该使用正常的英文字符来创建表、字段、索引等对象， 可以避免由于中文全角引号等特殊字符导致的特殊处理预期，增加可读性、可维护性、可操作性。
        3. 此规则包含而且不限于建表、建索引、修改字段名。可以适用于所有DDL 语句。比如 CREATE DATABASE、CREATE EVENT、CREATE FUNCTION、CREATE VIEW、CREATE SERVER 等。


    </示例>
        <检查流程描述>
        1. 对于“所有DDL” 语句，如果以下任意一项为真，则报告违反规则
            1. 语句中包含有中文全局引号“”

        </检查流程描述> 
        <知识文档>
        1. DDL 官方文档： https://dev.mysql.com/doc/refman/8.4/en/sql-data-definition-statements.html
      </知识文档>
    </场景>
    </规则场景>
<标签><分类 名称="操作对象"><分类值>数据库</分类值></分类><分类 名称="SQL分类"><分类值>DDL</分类值></分类><分类 名称="审核目的"><分类值>保障正确性</分类值><分类值>增强可维护性</分类值></分类><分类 名称="审核精确度"><分类值>不连库审核</分类值></分类></标签><完成情况>完成</完成情况></Rule>