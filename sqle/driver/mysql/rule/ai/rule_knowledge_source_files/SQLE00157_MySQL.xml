<?xml version='1.0' encoding='UTF-8'?>
<Rule>
  <规则编号>SQLE00157</规则编号>
  <级别>warn</级别>
  <数据库类型>MySQL</数据库类型>
  <规则种类>字段数据类型规范</规则种类>
  <适用性>不适用当前数据库</适用性>
  <规则简述>建议使用DATE替代TIMESTAMP类型</规则简述>
  <规则描述>TIMESTAMP数据类型消耗的空间远大于DATE，如果没有很高的时间精度要求，建议使用DATE类型</规则描述>
  <规则场景>
    <原理说明 数据库版本=" MySQL 所有版本" 检查方式="不连库审核">
      <示例>

          原理说明：
          1. MySQL 的 date 数据类型存储的数据为：年、月、日； 不存储小时、分钟、秒等数据，这点和Oracle 数据库完全不同。
          2. MySQL 的 包含年、月、日、时、分、秒级别的字段类型有 timestamp 和 datetime。
          3. MySQL 的 timestamp 类型，有经典的2038年问题，参考规则SQLE00068；但是存储空间只需要最多7个字节；
          4. MySQL 的 datetime 类型，没有 timestamp的 2038年问题，但是比 timestamp 占用的存储空间大，最多需要8个字节。
          5. 所以不存在 timestamp 类型消耗空间大的说法，本规则不适用。

          示例：
```sql
          create table t1(id int,
          log_date date,
          log_timestamp timestamp(6),
          log_datetime datetime(6)
          );

```
          示例说明：
          1. 表 t1 有两个字段，分别是date和 timestamp。
          2. 需要给表 t1 插入一条记录，看看两个字段的存储数据有什么不同。

          示例验证： 插入示例时间，结果显示date 类型 只到天；timestamp、datetime 类型都可以显示到微秒。

```sql
          (mysql:8.3.0:db_mysql)insert into t1 values (1,'2024-12-02 10:22:22.983332','2024-12-02 10:22:22.983332','2024-12-02 10:22:22.983332');
          Query OK, 1 row affected, 1 warning (0.04 sec)
          
          (mysql:8.3.0:db_mysql)select * from t1;
          +------+------------+----------------------------+----------------------------+
          | id   | log_date   | log_timestamp              | log_datetime               |
          +------+------------+----------------------------+----------------------------+
          |    1 | 2024-12-02 | 2024-12-02 10:22:22.983332 | 2024-12-02 10:22:22.983332 |
          +------+------------+----------------------------+----------------------------+
          1 row in set (0.00 sec)


```
           结论：
           1. 对于日期类型的字段，可以根据需要存储的日期粒度，来决定数据类型；如果只需要到天，那么选择date；如果需要精确到微秒，那么选择timestamp 或者 datetime。    
  
      </示例>

      <知识文档>
      1. CREATE TABLE 官方文档： https://dev.mysql.com/doc/refman/8.3/en/create-table.html
      2. 数据类型官方文档： https://dev.mysql.com/doc/refman/8.3/en/data-types.html
      </知识文档>
    </原理说明>
  </规则场景>
  <标签><分类 名称="操作对象"><分类值>字段</分类值></分类><分类 名称="SQL分类"><分类值>DDL</分类值></分类><分类 名称="审核目的"><分类值>保障正确性</分类值></分类><分类 名称="审核精确度"><分类值>不连库审核</分类值></分类></标签><完成情况>完成</完成情况></Rule>