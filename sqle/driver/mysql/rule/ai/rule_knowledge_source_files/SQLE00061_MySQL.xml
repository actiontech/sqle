<?xml version='1.0' encoding='UTF-8'?>
<Rule>
  <规则编号>SQLE00061</规则编号>
  <级别>error</级别>
  <数据库类型>MySQL</数据库类型>
  <规则种类>使用建议</规则种类>
  <规则简述>建议新建表句子中包含表存在判断操作</规则简述>
  <规则描述>新建表如果已经存在，不加 IF NOT EXISTS 会报错。新建表只在表不存在的前提下进行，避免SQL 实际执行报错。</规则描述>
  <规则场景>
    <场景 名称="创建表" 数据库版本="MySQL 所有版本 " 检查方式="不连库审核" 适用句型="CREATE TABLE">
      <示例>
          前置：
          create database db_mysql;
          use db_mysql;

          原理说明：
          1. 创建表加上if not exists 关键词，重复创建表不会报错；不加的话，如果表已经存在，则会直接报错。
          2. 如果建表语句存在脚本语言中，加上 if not exists 子句会减少脚本的代码量。

          反例SQL：
          create table t1( id int primary key ,last_updated timestamp);

          反例说明：
          1. 标准创建表t1的语法，如表存在，则报错。

          反例验证： 创建表直接报错
          (mysql:8.4.0:db_mysql)create table t1( id int primary key ,last_updated timestamp);
          ERROR 1050 (42S01): Table 't1' already exists


          正例SQL：
          create table if not exists t1( id int primary key ,last_updated timestamp);

          正例说明：
          1. 创建新表时，需要加 if not exists 子句，否则表存在时，则报错。 
          2. if not exists 子句减少了比如脚本代码中的错误处理量。

          正例验证： 正常创建，不报错，只报警告
          (mysql:8.4.0:db_mysql)create table if not exists t1( id int primary key ,last_updated timestamp);
          Query OK, 0 rows affected, 1 warning (0.01 sec)
          
          (mysql:8.4.0:db_mysql)show warnings;
          +-------+------+---------------------------+
          | Level | Code | Message                   |
          +-------+------+---------------------------+
          | Note  | 1050 | Table 't1' already exists |
          +-------+------+---------------------------+
          1 row in set (0.00 sec)
          
          结论：
          1. 创建表时，必须加if not exists 子句，否则表存在时，直接报错。
          2. 加上 if not exists 子句后，创建表不报错，只报警告，不影响语句正常执行。

      </示例>
      <检查流程描述>
        1. 对于 "CREATE TABLE ..."语句，如果存在以下任何一项，则报告违反规则：
          1. 句子中不包含关键词：IF NOT EXISTS
      </检查流程描述>
      <知识文档>
        1. CREATE TABLE 官方文档：https://dev.mysql.com/doc/refman/8.4/en/create-table.html
      </知识文档>
    </场景>
  </规则场景>
<标签><分类 名称="操作对象"><分类值>表</分类值></分类><分类 名称="SQL分类"><分类值>DDL</分类值></分类><分类 名称="审核目的"><分类值>保障正确性</分类值><分类值>增强可维护性</分类值></分类><分类 名称="审核精确度"><分类值>不连库审核</分类值></分类></标签><完成情况>完成</完成情况></Rule>